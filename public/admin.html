<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¸æˆå€’è®¡æ—¶é…ç½®ç®¡ç†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 40px;
            max-width: 600px;
            width: 100%;
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
            font-size: 1.1em;
        }
        
        input[type="number"] {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 1.1em;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }
        
        input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .time-display {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        button {
            flex: 1;
            padding: 15px 25px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn-secondary {
            background: #f8f9fa;
            color: #666;
            border: 2px solid #e1e5e9;
        }
        
        .btn-secondary:hover {
            background: #e9ecef;
            border-color: #adb5bd;
        }
        
        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: 500;
            display: none;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .current-config {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .current-config h3 {
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .config-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 8px;
        }
        
        .config-label {
            font-weight: 500;
            color: #555;
        }
        
        .config-value {
            color: #667eea;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® æ¸¸æˆå€’è®¡æ—¶é…ç½®ç®¡ç†</h1>
        
        <div class="current-config">
            <h2>å½“å‰è¿è¡Œæ¸¸æˆçŠ¶æ€</h2>
            <div class="config-item">
                <span class="config-label">æ¸¸æˆID:</span>
                <span class="config-value" id="currentGameId">åŠ è½½ä¸­...</span>
            </div>
            <div class="config-item">
                <span class="config-label">å½“å‰è½®æ¬¡:</span>
                <span class="config-value" id="currentRound">åŠ è½½ä¸­...</span>
            </div>
            <div class="config-item">
                <span class="config-label">å½“å‰é˜¶æ®µ:</span>
                <span class="config-value" id="currentPhase">åŠ è½½ä¸­...</span>
            </div>
            <div class="config-item">
                <span class="config-label">å‰©ä½™æ—¶é—´:</span>
                <span class="config-value" id="currentRemainingTime">åŠ è½½ä¸­...</span>
            </div>
            <div class="config-item">
                <span class="config-label">å½“å‰çˆ†ç‡:</span>
                <span class="config-value" id="currentGameCrashMultiplier">åŠ è½½ä¸­...</span>
            </div>
        </div>
        
        <div class="current-config">
            <h2>å½“å‰é…ç½®æ–‡ä»¶</h2>
            <div class="config-item">
                <span class="config-label">ä¸‹æ³¨é˜¶æ®µæ—¶é•¿:</span>
                <span class="config-value" id="currentBetting">åŠ è½½ä¸­...</span>
            </div>
            <div class="config-item">
                <span class="config-label">ç­‰å¾…é˜¶æ®µæ—¶é•¿:</span>
                <span class="config-value" id="currentWaiting">åŠ è½½ä¸­...</span>
            </div>
            <div class="config-item">
                <span class="config-label">æ¸¸æˆé˜¶æ®µæ—¶é•¿:</span>
                <span class="config-value" id="currentGame">åŠ è½½ä¸­...</span>
            </div>
            <div class="config-item">
                <span class="config-label">å›ºå®šçˆ†ç‡å€¼:</span>
                <span class="config-value" id="currentCrashMultiplier">åŠ è½½ä¸­...</span>
            </div>
        </div>
        
        <form id="configForm">
            <div class="form-group">
                <label for="bettingCountdown">ä¸‹æ³¨é˜¶æ®µæ—¶é•¿ (æ¯«ç§’)</label>
                <input type="number" id="bettingCountdown" min="5000" max="1800000" step="1000" placeholder="ä¾‹å¦‚: 30000 (30ç§’)" required>
                <div class="time-display" id="bettingDisplay">èŒƒå›´: 5ç§’ - 30åˆ†é’Ÿ</div>
            </div>
            
            <div class="form-group">
                <label for="waitingCountdown">ç­‰å¾…é˜¶æ®µæ—¶é•¿ (æ¯«ç§’)</label>
                <input type="number" id="waitingCountdown" min="1000" max="60000" step="1000" placeholder="ä¾‹å¦‚: 3000 (3ç§’)" required>
                <div class="time-display" id="waitingDisplay">èŒƒå›´: 1ç§’ - 1åˆ†é’Ÿ</div>
            </div>
            
            <div class="form-group">
                <label for="gameCountdown">æ¸¸æˆé˜¶æ®µæ—¶é•¿ (æ¯«ç§’)</label>
                <input type="number" id="gameCountdown" min="5000" max="1800000" step="1000" placeholder="ä¾‹å¦‚: 60000 (60ç§’)" required>
                <div class="time-display" id="gameDisplay">èŒƒå›´: 5ç§’ - 30åˆ†é’Ÿ</div>
            </div>
            
            <div class="form-group">
                <label for="crashMultiplier">å›ºå®šçˆ†ç‡å€¼</label>
                <input type="number" id="crashMultiplier" min="0" max="1000" step="0.01" placeholder="ä¾‹å¦‚: 2.5 (è¾“å…¥0è¡¨ç¤ºéšæœºçˆ†ç‡)">
                <div class="time-display" id="crashDisplay">èŒƒå›´: 1.01 - 1000.00 (ç•™ç©ºæˆ–è¾“å…¥0è¡¨ç¤ºä½¿ç”¨éšæœºçˆ†ç‡)</div>
            </div>
            
            <div class="button-group">
                <button type="button" class="btn-secondary" onclick="loadCurrentConfig()">åˆ·æ–°é…ç½®</button>
                <button type="submit" class="btn-primary">æ›´æ–°é…ç½®</button>
            </div>
        </form>
        
        <div class="status" id="status"></div>
    </div>

    <script>
        // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
        function formatTime(ms) {
            const seconds = Math.floor(ms / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            
            if (hours > 0) {
                return `${hours}å°æ—¶${minutes % 60}åˆ†${seconds % 60}ç§’`;
            } else if (minutes > 0) {
                return `${minutes}åˆ†${seconds % 60}ç§’`;
            } else {
                return `${seconds}ç§’`;
            }
        }
        
        // æ›´æ–°æ—¶é—´æ˜¾ç¤º
        function updateTimeDisplay(inputId, displayId) {
            const input = document.getElementById(inputId);
            const display = document.getElementById(displayId);
            
            input.addEventListener('input', function() {
                const value = parseInt(this.value);
                if (value && value >= 5000 && value <= 1800000) {
                    display.textContent = `${formatTime(value)} (${value}æ¯«ç§’)`;
                    display.style.color = '#28a745';
                } else if (value) {
                    display.textContent = 'è¶…å‡ºæœ‰æ•ˆèŒƒå›´ (5ç§’ - 30åˆ†é’Ÿ)';
                    display.style.color = '#dc3545';
                } else {
                    display.textContent = 'èŒƒå›´: 5ç§’ - 30åˆ†é’Ÿ';
                    display.style.color = '#666';
                }
            });
        }
        
        // æ›´æ–°çˆ†ç‡æ˜¾ç¤º
        function updateCrashDisplay() {
            const input = document.getElementById('crashMultiplier');
            const display = document.getElementById('crashDisplay');
            
            input.addEventListener('input', function() {
                const value = parseFloat(this.value);
                if (value <= 0) {
                    display.textContent = 'éšæœºçˆ†ç‡';
                    display.style.color = '#28a745';
                } else if (value && value >= 1.01 && value <= 1000) {
                    display.textContent = `çˆ†ç‡: ${value}x`;
                    display.style.color = '#28a745';
                } else if (value && (value < 1.01 || value > 1000)) {
                    display.textContent = 'è¶…å‡ºæœ‰æ•ˆèŒƒå›´ (1.01 - 1000.00)';
                    display.style.color = '#dc3545';
                } else {
                    display.textContent = 'èŒƒå›´: 1.01 - 1000.00 (ç•™ç©ºæˆ–è¾“å…¥0è¡¨ç¤ºä½¿ç”¨éšæœºçˆ†ç‡)';
                    display.style.color = '#666';
                }
            });
        }
        
        // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
        function showStatus(message, isSuccess = true) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${isSuccess ? 'success' : 'error'}`;
            status.style.display = 'block';
            
            setTimeout(() => {
                status.style.display = 'none';
            }, 5000);
        }
        
        // åŠ è½½å½“å‰è¿è¡ŒçŠ¶æ€
        async function loadCurrentStatus() {
            try {
                const response = await fetch('/api/game/countdown');
                
                if (!response.ok) {
                    throw new Error(`HTTPé”™è¯¯: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.success && result.data) {
                    const data = result.data;
                    
                    document.getElementById('currentGameId').textContent = data.gameId || 'æ— ';
                    document.getElementById('currentRound').textContent = data.round || '0';
                    
                    // é˜¶æ®µæ˜¾ç¤º
                    const phaseMap = {
                        'betting': 'ä¸‹æ³¨é˜¶æ®µ',
                        'waiting': 'ç­‰å¾…é˜¶æ®µ', 
                        'gaming': 'æ¸¸æˆé˜¶æ®µ',
                        'idle': 'ç©ºé—²'
                    };
                    document.getElementById('currentPhase').textContent = phaseMap[data.phase] || data.phase;
                    
                    // å‰©ä½™æ—¶é—´æ˜¾ç¤º
                    if (data.remainingTime > 0) {
                        document.getElementById('currentRemainingTime').textContent = formatTime(data.remainingTime);
                    } else {
                        document.getElementById('currentRemainingTime').textContent = 'æ— ';
                    }
                    
                    // å½“å‰çˆ†ç‡æ˜¾ç¤º
                    if (data.fixedCrashMultiplier && data.fixedCrashMultiplier > 0) {
                        document.getElementById('currentGameCrashMultiplier').textContent = `${data.fixedCrashMultiplier}x`;
                    } else {
                        document.getElementById('currentGameCrashMultiplier').textContent = 'éšæœºçˆ†ç‡';
                    }
                }
            } catch (error) {
                console.error('åŠ è½½è¿è¡ŒçŠ¶æ€å¤±è´¥:', error);
                document.getElementById('currentGameId').textContent = 'åŠ è½½å¤±è´¥';
                document.getElementById('currentRound').textContent = 'åŠ è½½å¤±è´¥';
                document.getElementById('currentPhase').textContent = 'åŠ è½½å¤±è´¥';
                document.getElementById('currentRemainingTime').textContent = 'åŠ è½½å¤±è´¥';
                document.getElementById('currentGameCrashMultiplier').textContent = 'åŠ è½½å¤±è´¥';
            }
        }
        
        // åŠ è½½å½“å‰é…ç½®
        async function loadCurrentConfig() {
            try {
                console.log('å¼€å§‹åŠ è½½é…ç½®...');
                const response = await fetch('/api/game/countdown/config');
                console.log('APIå“åº”çŠ¶æ€:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTPé”™è¯¯: ${response.status}`);
                }
                
                const result = await response.json();
                console.log('APIè¿”å›æ•°æ®:', result);
                
                if (result.success && result.data) {
                    const { bettingCountdown, waitingCountdown, gameCountdown, fixedCrashMultiplier } = result.data;
                    console.log('é…ç½®æ•°æ®:', { bettingCountdown, waitingCountdown, gameCountdown, fixedCrashMultiplier });
                    
                    if (bettingCountdown && waitingCountdown && gameCountdown) {
                        document.getElementById('currentBetting').textContent = formatTime(bettingCountdown);
                        document.getElementById('currentWaiting').textContent = formatTime(waitingCountdown);
                        document.getElementById('currentGame').textContent = formatTime(gameCountdown);
                        document.getElementById('currentCrashMultiplier').textContent = (fixedCrashMultiplier > 0) ? `${fixedCrashMultiplier}x` : 'éšæœºçˆ†ç‡';
                        
                        // é¢„å¡«å……è¡¨å•
                        document.getElementById('bettingCountdown').value = bettingCountdown;
                        document.getElementById('waitingCountdown').value = waitingCountdown;
                        document.getElementById('gameCountdown').value = gameCountdown;
                        if (fixedCrashMultiplier > 0) {
                            document.getElementById('crashMultiplier').value = fixedCrashMultiplier;
                        } else {
                            document.getElementById('crashMultiplier').value = '';
                        }
                        
                        // è§¦å‘æ—¶é—´æ˜¾ç¤ºæ›´æ–°
                        document.getElementById('bettingCountdown').dispatchEvent(new Event('input'));
                        document.getElementById('waitingCountdown').dispatchEvent(new Event('input'));
                        document.getElementById('gameCountdown').dispatchEvent(new Event('input'));
                        document.getElementById('crashMultiplier').dispatchEvent(new Event('input'));
                        
                        console.log('é…ç½®åŠ è½½æˆåŠŸ');
                    } else {
                        throw new Error('é…ç½®æ•°æ®ä¸å®Œæ•´');
                    }
                } else {
                    throw new Error(result.message || 'è·å–é…ç½®å¤±è´¥');
                }
            } catch (error) {
                console.error('åŠ è½½é…ç½®å¤±è´¥:', error);
                document.getElementById('currentBetting').textContent = 'åŠ è½½å¤±è´¥';
                document.getElementById('currentWaiting').textContent = 'åŠ è½½å¤±è´¥';
                document.getElementById('currentGame').textContent = 'åŠ è½½å¤±è´¥';
                showStatus('åŠ è½½å½“å‰é…ç½®å¤±è´¥: ' + error.message, false);
            }
        }
        
        // è¡¨å•æäº¤å¤„ç†
        document.getElementById('configForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const bettingCountdown = parseInt(document.getElementById('bettingCountdown').value);
            const waitingCountdown = parseInt(document.getElementById('waitingCountdown').value);
            const gameCountdown = parseInt(document.getElementById('gameCountdown').value);
            const crashMultiplier = parseFloat(document.getElementById('crashMultiplier').value);
            
            // éªŒè¯è¾“å…¥
            if (!bettingCountdown || !waitingCountdown || !gameCountdown) {
                showStatus('è¯·å¡«å†™å®Œæ•´çš„é…ç½®ä¿¡æ¯', false);
                return;
            }
            
            if (bettingCountdown < 5000 || bettingCountdown > 1800000 || 
                gameCountdown < 5000 || gameCountdown > 1800000) {
                showStatus('ä¸‹æ³¨å’Œæ¸¸æˆé˜¶æ®µæ—¶é—´é…ç½®è¶…å‡ºæœ‰æ•ˆèŒƒå›´ (5ç§’ - 30åˆ†é’Ÿ)', false);
                return;
            }
            
            if (waitingCountdown < 1000 || waitingCountdown > 60000) {
                showStatus('ç­‰å¾…é˜¶æ®µæ—¶é—´é…ç½®è¶…å‡ºæœ‰æ•ˆèŒƒå›´ (1ç§’ - 1åˆ†é’Ÿ)', false);
                return;
            }
            
            if (crashMultiplier && crashMultiplier !== 0 && (crashMultiplier < 1.01 || crashMultiplier > 1000)) {
                showStatus('çˆ†ç‡å€¼è¶…å‡ºæœ‰æ•ˆèŒƒå›´ (1.01 - 1000.00ï¼Œæˆ–è¾“å…¥0è¡¨ç¤ºéšæœº)', false);
                return;
            }
            
            try {
                const requestBody = {
                    bettingCountdown,
                    waitingCountdown,
                    gameCountdown
                };
                
                // æ·»åŠ çˆ†ç‡å€¼åˆ°è¯·æ±‚ä¸­ï¼ˆå¦‚æœä¸ºç©ºæˆ–0åˆ™è¡¨ç¤ºéšæœºçˆ†ç‡ï¼‰
                if (crashMultiplier === 0 || (crashMultiplier >= 1.01 && crashMultiplier <= 1000)) {
                    requestBody.crashMultiplier = crashMultiplier || 0;
                } else {
                    requestBody.crashMultiplier = 0; // 0è¡¨ç¤ºéšæœºçˆ†ç‡
                }
                
                const response = await fetch('/api/game/countdown/config', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus('é…ç½®æ›´æ–°æˆåŠŸï¼', true);
                    // é‡æ–°åŠ è½½å½“å‰é…ç½®å’ŒçŠ¶æ€
                    await loadCurrentConfig();
                    await loadCurrentStatus();
                } else {
                    throw new Error(result.message || 'æ›´æ–°å¤±è´¥');
                }
            } catch (error) {
                console.error('æ›´æ–°é…ç½®å¤±è´¥:', error);
                showStatus('é…ç½®æ›´æ–°å¤±è´¥: ' + error.message, false);
            }
        });
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateTimeDisplay('bettingCountdown', 'bettingDisplay');
            updateTimeDisplay('waitingCountdown', 'waitingDisplay');
            updateTimeDisplay('gameCountdown', 'gameDisplay');
            updateCrashDisplay();
            loadCurrentConfig();
            loadCurrentStatus();
            
            // å®šæ—¶åˆ·æ–°è¿è¡ŒçŠ¶æ€ï¼ˆæ¯5ç§’ï¼‰
            setInterval(loadCurrentStatus, 5000);
        });
    </script>
</body>
</html>